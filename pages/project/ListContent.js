import React, { useState} from 'react';
import {
    Layout,
    Button,
    Breadcrumb,
    Avatar,
    Toast, Card, Col, Row, Highlight, Checkbox, Transfer, Divider, TextArea
} from '@douyinfe/semi-ui';
import {
    IconBeaker, IconClose, IconSort,
} from '@douyinfe/semi-icons';
import "@douyinfe/semi-ui/dist/css/semi.css";
const ListContent = () => {
    const { Header, Footer, Sider, Content } = Layout;
    const allCandidate = async () => {
        try{
            const response = await fetch('http://127.0.0.1:8080/api/all',{
                method:'POST',
            });
            const data = await response.json()
            console.log(data)
            let opts = {
                content: 'üë®‚Äçüë©‚Äçüëß‚ÄçüëßÂÄôÈÄâËÄÖÈìæ‰∏äÂú∞ÂùÄÂàóË°®‰∏∫:  '+data.all+"ÔºàÊ≠§Êï∞ÊçÆÁî±Èìæ‰∏äËØªÂèñÔºâ",
                duration: 2,
                theme: 'light',
            };
            Toast.info(opts)
        }catch (error){
            Toast.error(error.message)
        }

    }

    const getWinner = async () => {
        try{
            //ÂÖàÊãøÂà∞ÂΩìÂâçÊäïÁ•®Áä∂ÊÄÅ
            const response1 = await fetch('http://127.0.0.1:8080/api/status',{
                method:'POST',
            });
            const data1 = await response1.json()
            if(data1.status){
                Toast.info("ÊäïÁ•®Êú™ÁªìÊùüÔºåËØ∑Á≠âÂæÖÁÆ°ÁêÜÂëòÁªìÊùüÊäïÁ•®ÂÜçÊü•ÁúãËé∑ËÉúËÄÖ")
                return ;
            }
            const response = await fetch('http://127.0.0.1:8080/api/winner',{
                method:'POST',
            });
            const data = await response.json()
                let opts = {
                    content: 'ü•≥‰∏ä‰∏ÄËΩÆÊäïÁ•®Ëé∑ËÉúËÄÖÁöÑÂå∫ÂùóÈìæÂú∞ÂùÄÊòØ:  '+data.winnerAddress,
                    duration: 2,
                    theme: 'light',
                };
                Toast.success(opts)
        }catch (error){
            Toast.error(error.message)
        }
    }

    const getVoteStatus = async () => {
        try{
            const response = await fetch('http://127.0.0.1:8080/api/status',{
                method:'POST',
            });
            const data = await response.json()
            if(data.status){
                let opts = {
                    content: "üôã‚Äç‚ôÇÔ∏èÂΩìÂâçÊäïÁ•®Â∑≤ÂºÄÂßãÔºåËØ∑ËÆ§ÁúüÊ†∏ÂØπÂú∞ÂùÄÂπ∂ÊäïÂá∫Ëá™Â∑±ÁöÑ‰∏ÄÁ•®",
                    duration: 2,
                    theme: 'light',
                };
                Toast.info(opts )
            }else
            {
                let opts = {
                    content: "üôÖ‚Äç‚ôÇÔ∏èÊäïÁ•®Êú™ÂºÄÂßãÔºåËØ∑ÂâçÂæÄÊäïÁ•®È°µÈù¢ÂàõÂª∫ÊäïÁ•®",
                    duration: 2,
                    theme: 'light',
                };
                Toast.info(opts)
            }
        }catch(error){
            Toast.error(error.message)
        }
    }

    const closeVoting = async () => {
        const response = await fetch('http://127.0.0.1:8080/api/status',{
            method:'POST',
        });
        const data = await response.json()
        if(!data.status){
            Toast.info("ÊäïÁ•®Â∑≤ÁªìÊùüÔºåÊó†ÈúÄÂÖ≥Èó≠")
            return ;
        }
        try{
            const response = await fetch('http://127.0.0.1:8080/api/close',{
                method:'POST',
            });
            const data = await response.json()
            let opts = {
                content: 'ÂÖ≥Èó≠ÊäïÁ•®ÊàêÂäüÔºÅÂΩìÂâç‰∫§ÊòìÂìàÂ∏å‰∏∫:  '+data.tx,
                duration: 2,
                theme: 'light',
            };
            Toast.success(opts)
        }catch (error){
            Toast.error(error.message)
        }

    }
    const [selectedItems, setSelectedItems] = useState([]);
    const [searchText, setSearchText] = useState('');


    //ÂÖ®ÈÉ®Áî®Êà∑‰ø°ÊÅØÊ°Ü
    const renderSourceItem = item => {
        return (
            <div className="components-transfer-demo-source-item" key={item.label}>
                <Checkbox
                    onChange={() => {
                        item.onChange();
                    }}
                    key={item.label}
                    checked={item.checked}
                    style={{ height: 60, alignItems: 'center' }}
                >
                    <Avatar color={item.color} size="small" >
                        {item.abbr}
                    </Avatar>
                    <div className="info">
                        <div className="name" style={{fontWeight:800}}>
                            <Highlight sourceString={item.label} searchWords={[searchText]}></Highlight>
                        </div>
                        <div className="address">
                            <Highlight sourceString={item.value} searchWords={[searchText]}></Highlight>
                        </div>
                    </div>
                </Checkbox>
                <style jsx>
                    {`
          .components-transfer-demo-selected-item {
                .semi-icon-close {
                    visibility: hidden;
                    color: var(--semi-color-tertiary);
                }
                &:hover {
                    .semi-icon-close {
                        visibility: visible;
                    }
                }
            }
                `}
                </style>
            </div>

        );
    };

    //ÈÄâ‰∏≠Áî®Êà∑‰ø°ÊÅØÊ°Ü
    const renderSelectedItem = item => {
        return (
            <div className="components-transfer-demo-selected-item" key={item.label}>
                <Avatar color={item.color} size="small">
                    {item.abbr}
                </Avatar>
                <div className="info">
                    <div className="name" style={{fontWeight:800}}>{item.label}</div>
                    <div className="address">Âú∞ÂùÄÔºö{item.value}</div>
                    <div className="id">Â∑•Âè∑Ôºö{item.id}</div>
                </div>
                <IconClose onClick={item.onRemove} />
                <style jsx>
                    {
                        `
 .components-transfer-demo-selected-item,
            .components-transfer-demo-source-item {
                height: 52px;
                box-sizing: border-box;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px 12px;
                &:hover {
                    background-color: var(--semi-color-fill-0);
                }
                .info {
                    margin-left: 8px;
                    flex-grow: 1;
                }
                .name {
                    font-size: 14px;
                    line-height: 20px;
                }
                .address {
                    font-size: 12px;
                    line-height: 16px;
                    color: var(--semi-color-text-2);
                }
                .id {
                    font-size: 12px;
                    line-height: 16px;
                    color: var(--semi-color-text-2);
                }
            }
                  
                        `
                    }
                </style>
            </div>
        );
    };

    const customFilter = (sugInput, item) => {
        return item.value.includes(sugInput) || item.label.includes(sugInput);
    };
    const [data, setData] = useState([]);
    //‰ªéÊï∞ÊçÆÂ∫ì‰∏≠ËØªÂèñÁî®Êà∑‰ø°ÊÅØÂ≠óÊÆµ
    const getUserData = async () =>{
        try {
            const response = await fetch('http://127.0.0.1:8080/api/user',{
                method:"GET"
            });
            const users = await response.json();
            setData(users);
            Toast.info("Êï∞ÊçÆÂ∫ìËøûÊé•Ê≠£Â∏∏ÔºåÊï∞ÊçÆËΩΩÂÖ•ÊàêÂäü")
        } catch (error) {
            Toast.error('Ëé∑ÂèñÊï∞ÊçÆÂºÇÂ∏∏:'+ error);
        }
    }

    //Âà∑Êñ∞Êï∞ÊçÆ
    const flashUserData =async () =>{
        setData([])
        Toast.info("‰ø°ÊÅØÂ∑≤Ê∏ÖÁ©∫ÔºåÊï∞ÊçÆÊ≠£Âú®ÈáçÊñ∞ËΩΩÂÖ•")
        //Âª∂Ëøü‰∏Ä‰ºöÂÑø
        setTimeout(async () => {
            await getUserData(); // Á°Æ‰øùÁ≠âÂæÖ getUserData ÂÆåÊàê
        }, 1500);
    }


    //‰∏¥Êó∂ÊµãËØïÔºåÂêéÁª≠Êï∞ÊçÆÂ∫ìÂÜôÂÖ•
    // const data = [
    //     { label: 'ÁéãÂèØÁÑ∂', value: '0xc13fc67f57046a56252ef63ded46eb9540ef0292', abbr: 'Áéã', color: 'amber', id: '20240906', key: 1 },
    //     { label: 'ÊùéÊú®Â≠ê', value: '0x34793fb8cb95f34c43502957fcdbaeb72fe00173', abbr: 'Êùé', color: 'indigo', id: '19980808', key: 2 },
    //     { label: 'ÂàòËíôËµÑ', value: '0x9f53c48348740c8978f7605a5b1117a7630f8d00', abbr: 'Âàò', color: 'cyan', id: '20150702', key: 3 },
    //     { label: 'Èõ∑Á£ä', value: '0x165ba77af2cba78f41d1865d54279858389ef204', abbr: 'Èõ∑', color: 'blue', id: '20170306', key: 4 },
    //     { label: 'ÁéãËééËéé', value: '0x259e9b57d926b1652fd5ee0304d0634e62a9bcc6', abbr: 'Áéã', color: 'red', id: '20070915', key: 5 },
    //     { label: 'ËÉ°‰πé‰πé', value: '0x4823c6f8af6bbf880d8163fc2367e41cd7561372', abbr: 'ËÉ°', color: 'violet', id: '20011216', key: 6 },
    //     { label: 'ÂîêÁêÉÁßã', value: '0x7cfa67e06dc2cf5ead8d75dadea55d0343f5d99a', abbr: 'Âîê', color: 'lime', id: '20011216', key: 7 },
    // ];

    const handleTransferChange = (values, items) => {
        const selectedValues = items.map(item => item.value);
        setSelectedItems(selectedValues);
        console.log(values, items);
        console.log(selectedItems)
    };

    const concatenatedValues = selectedItems.map(value => `"${value}"`).join(',');
    console.log(concatenatedValues)

    // Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÁöÑÂáΩÊï∞
    const copyToClipboard = async (text) => {
        try {
            await navigator.clipboard.writeText(text);
            let opts = {
                content: "‰ø°ÊÅØÂ∑≤Â§çÂà∂Âà∞Ââ™ÂàáÊùø",
                duration: 2,

            };
           Toast.info(opts)
        } catch (err) {
            Toast.error('Â§çÂà∂Â§±Ë¥•'+err);
        }
    };








    return (
        <Content
            style={{
                padding: '24px',
                backgroundColor: 'var(--semi-color-bg-0)',
            }}
        >
            <Breadcrumb
                style={{
                    marginBottom: '24px',
                }}
                routes={
                    [
                        {
                            path: '/',
                            name:'blockvote',
                        },
                        {
                            path: '/list',
                            name: 'list',
                            icon: <IconBeaker size="small" />
                        },

                    ]
                }
            />
            <div
                style={{
                    borderRadius: '10px',
                    border: '1px solid var(--semi-color-border)',
                    height: '390px',
                    padding: '32px',
                }}
            >
                <div
                    style={{
                        borderRadius: '10px',
                        border: '2px solid var(--semi-color-border)',
                        height: '340px', // ËÆæÁΩÆ‰∏Ä‰∏™Âõ∫ÂÆöÁöÑÈ´òÂ∫¶
                        padding: '35px',
                        overflow: 'auto', // Ê∑ªÂä†ÊªöÂä®Êù°
                    }}
                >
                <div className="container">
                    <div style={{marginLeft:"75px"}}>
                        <div
                            style={{
                                display: 'inline-block',
                                padding: 20,
                                backgroundColor: '#cad3c3',
                                marginRight:"0px",

                            }}
                        >
                            <Card
                                style={{ maxWidth: 300 }}
                                bordered={false}
                                headerLine={true}
                                title='Ë∞ÅÊòØËµ¢ÂÆ∂‚úå'

                            >
                                ÊäïÁ•®ÁªìÊùüÂêéÔºåÁÇπÂáªÊ≠§ÊåâÈíÆÊü•ÁúãÊäïÁ•®ÁªìÊûúÔºåÂ∞Ü‰ªéÈìæ‰∏äËøîÂõû‰∏Ä‰∏™Á¥ØËÆ°Ëé∑ÂæóÈÄâÁ•®Êï∞ÊúÄÂ§ßÁöÑÂú∞ÂùÄ
                                <br/>
                                <Button theme='light' type='secondary' style={{ marginRight: 8, color:"rgba(var(--semi-light-green-5), 1)"}} onClick={getWinner}>Winner</Button>
                            </Card>
                        </div>
                        <div
                            style={{
                                display: 'inline-block',
                                padding: 20,
                                backgroundColor: '#b0a4e3',
                                marginRight:"0px"
                            }}
                        >
                            <Card
                                style={{ maxWidth: 300 }}
                                bordered={false}
                                headerLine={true}
                                title='Êü•ËØ¢ÂÄôÈÄâËÄÖüîç'

                            >
                                ÁÇπÂáªÊ≠§ÊåâÈíÆÔºåÂ∞Ü‰ºöËøîÂõû‰∏Ä‰∏™‰ªéÈìæ‰∏äËØªÂèñÁöÑÂÄôÈÄâËÄÖÂú∞ÂùÄÈõÜÂêàÔºåÊúâÂä©‰∫éÊÇ®Âà§Êñ≠ÂâçÁ´ØÁïåÈù¢Â±ïÁ§∫ÁöÑÂÄôÈÄâÂú∞ÂùÄÁöÑÊúâÊïàÊÄßÂíåÁúüÂÆûÊÄß
                                <br/>
                                <Button theme='light' type='secondary' style={{ marginRight: 8 ,color:"rgba(var(--semi-purple-4), 1)"} } onClick={allCandidate} >Candidate</Button>
                            </Card>
                        </div>
                        <div
                            style={{
                                display: 'inline-block',
                                padding: 20,
                                backgroundColor: '#eeb8c3'
                            }}
                        >
                            <Card
                                style={{ maxWidth: 300 }}
                                bordered={false}
                                headerLine={true}
                                title='ÊäïÁ•®Áä∂ÊÄÅüçÄ'

                            >
                                ÁÇπÂáªÊ≠§ÊåâÈíÆÊü•ËØ¢ÊäïÁ•®ÊòØÂê¶ÂºÄÂêØÔºåÂ∞Ü‰ªéÈìæ‰∏äËØªÂèñÊäïÁ•®Áä∂ÊÄÅÔºåËã•ÁªìÊûú‰∏∫TRUEÂàôÊäïÁ•®ÂºÄÂêØÔºåÂèç‰πãÂÖ≥Èó≠‰∏çÂèØÊäïÁ•®
                                <br/>
                                <Button theme='light' type='secondary' style={{ marginRight: 8,color:"rgba(var(--semi-pink-5), 1)" }} onClick={getVoteStatus}>Status</Button>
                            </Card>
                        </div>
                    </div>
                    <br/>
                    <Button theme='light' type='secondary'  size='large' style={{ marginLeft: 550,color:"rgba(var(--semi-orange-3), 1)" }} onClick={closeVoting}>ÂÖ≥Èó≠ÊäïÁ•®</Button>
                    <Divider margin='12px'>
                        <IconSort />
                    </Divider>
                    <Row style={{ alignItems: 'center', justifyContent: 'end' }}>
                        <Col span={18}>
                            <Transfer
                                style={{ width: 800 }}
                                draggable
                                dataSource={data}
                                filter={customFilter}
                                renderSelectedItem={renderSelectedItem}
                                renderSourceItem={renderSourceItem}
                                inputProps={{ placeholder: 'ÊêúÁ¥¢ÂßìÂêçÊàñÂú∞ÂùÄ' }}
                                onSearch={searchText => setSearchText(searchText)}
                                onChange={handleTransferChange}
                            />
                        </Col>
                        <Col span={6} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                            <TextArea
                                maxCount={1000}
                                style={{ width: '100%', marginBottom: '10px' }}
                                value={concatenatedValues}
                                placeholder='Â∑¶‰æßÂãæÈÄâÁî®Êà∑‰ø°ÊÅØÔºåÁ≥ªÁªüËá™Âä®ÊèêÂèñÂπ∂‰∏≤ËÅîÂú∞ÂùÄ‰ø°ÊÅØ'
                            />
                            <Row style={{ width: '100%',justifyContent: 'flex-end' ,marginRight:"10px"}}>
                                <Button style={{ marginLeft: '22px' }} onClick={() => copyToClipboard(concatenatedValues)}>Â§çÂà∂‰ø°ÊÅØ</Button>
                                <Button style={{ marginLeft: '6px' }}onClick={() => flashUserData()} >Âà∑Êñ∞Áî®Êà∑</Button>
                                <Button style={{ marginLeft: '6px' }} onClick={() => getUserData()}>Âä†ËΩΩÁî®Êà∑</Button>
                            </Row>
                        </Col>
                    </Row>
                </div>
                </div>
            </div>
            <style jsx>
                {
                    `
            .components-transfer-demo-selected-item {
                .semi-icon-close {
                    visibility: hidden;
                    color: var(--semi-color-tertiary);
                }
                &:hover {
                    .semi-icon-close {
                        visibility: visible;
                    }
                }
            }

            .components-transfer-demo-selected-item,
            .components-transfer-demo-source-item {
                height: 52px;
                box-sizing: border-box;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px 12px;
                &:hover {
                    background-color: var(--semi-color-fill-0);
                }
                .info {
                    margin-left: 8px;
                    flex-grow: 1;
                }
                .name {
                    font-size: 14px;
                    line-height: 20px;
                }
                .email {
                    font-size: 12px;
                    line-height: 16px;
                    color: var(--semi-color-text-2);
                }
            }
                    `
                }
            </style>
        </Content>
    );
};

export default ListContent;
